{"ast":null,"code":"var _jsxFileName = \"/Users/phoebe0506/github-classroom/CMU-SSUI-Fall2022/hw5-hsuanjuw/src/App.js\";\nimport React, { Component } from \"react\";\nimport ControlPanel from \"./containers/ControlPanel/ControlPanel\";\nimport Workspace from \"./containers/Workspace/Workspace\";\nimport HistoryPanel from \"./containers/HistoryPanel/HistoryPanel\";\nimport ControlContext from \"./contexts/control-context\";\nimport { genId, defaultValues } from \"./shared/util\";\nimport ChangeFillColorCommandObject from \"./shared/commandObjects/ChangeFillColorCommandObject\";\nimport ChangeBorderColorCmdObj from \"./shared/commandObjects/ChangeBorderColorCmdObj\";\nimport ChangeBorderWidthCmdObj from \"./shared/commandObjects/ChangeBorderWidthCmdObj\";\nimport AddShapeCmdObj from \"./shared/commandObjects/AddShapeCmdObj\";\nimport DeleteCmdObj from \"./shared/commandObjects/DeleteCmdObj\";\nimport MoveCmdObj from \"./shared/commandObjects/MoveCmdObj\";\nimport \"./App.css\";\n\nclass App extends Component {\n  constructor() {\n    super();\n    /*\n     * pass this undoHandler into command object constructors:\n     *  e.g. let cmdObj = new ChangeFillColorCommandObject(this.undoHandler);\n     */\n\n    this.state = {\n      // controls\n      currMode: defaultValues.mode,\n      currBorderColor: defaultValues.borderColor,\n      currBorderWidth: defaultValues.borderWidth,\n      currFillColor: defaultValues.fillColor,\n      // workspace\n      shapes: [],\n      shapesMap: {},\n      selectedShapeId: undefined,\n      // handling undo/redo\n      commandList: [],\n      currCommand: -1,\n      undoAllowed: false,\n      redoAllowed: false,\n      //handle key pressed\n      undoKeys: {\n        cKey: false,\n        zKey: false\n      },\n      redoKeys: {\n        cKey: false,\n        yKey: false\n      }\n    };\n\n    this.registerExecution = commandObject => {\n      let newCmdList = [];\n\n      if (this.state.commandList.length !== this.state.currCommand + 1) {\n        newCmdList = this.state.commandList.slice(0, this.state.currCommand + 1);\n      } else {\n        newCmdList = [...this.state.commandList];\n      }\n\n      this.setState({\n        commandList: [...newCmdList, commandObject],\n        currCommand: this.state.currCommand + 1\n      });\n    };\n\n    this.undo = () => {\n      //console.log(\"undo\");\n      if (this.state.currCommand - 1 === -1) {\n        this.setState({\n          undoAllowed: false\n        });\n      }\n\n      if (this.state.currCommand !== -1) {\n        this.setState({\n          selectedShapeId: this.state.commandList[this.state.currCommand].selectedShapeId\n        });\n        this.state.commandList[this.state.currCommand].undo(); //var oldValue = this.state.commandList[this.state.currCommand].oldValue;\n        //this.updateShape(this.state.commandList[this.state.currCommand].selectedShapeId, { oldValue });\n\n        this.setState({\n          currCommand: this.state.currCommand - 1,\n          redoAllowed: true\n        });\n      }\n    };\n\n    this.redo = () => {\n      //console.log(\"redo\"); \n      if (this.state.currCommand + 1 === this.state.commandList.length - 1) {\n        this.setState({\n          redoAllowed: false,\n          undoAllowed: true\n        });\n      }\n\n      this.state.commandList[this.state.currCommand + 1].redo();\n      this.setState({\n        currCommand: this.state.currCommand + 1\n      });\n    };\n\n    this.addShape = shapeData => {\n      let shapes = [...this.state.shapes];\n      let shapesMap = { ...this.state.shapesMap\n      };\n      const id = genId();\n      shapesMap[id] = { ...shapeData,\n        id\n      };\n      shapes.push(id);\n      this.setState({\n        shapes,\n        shapesMap,\n        selectedShapeId: id,\n        undoAllowed: true\n      });\n      let cmdObj = new AddShapeCmdObj(this.undoHandler, shapeData, id);\n      cmdObj.execute();\n    };\n\n    this.updateShape = (shapeId, newData) => {\n      let shapesMap = { ...this.state.shapesMap\n      };\n      let targetShape = shapesMap[shapeId];\n      shapesMap[shapeId] = { ...targetShape,\n        ...newData\n      };\n      this.setState({\n        shapesMap\n      });\n    };\n\n    this.moveShape = newData => {\n      if (this.state.selectedShapeId) {\n        this.updateShape(this.state.selectedShapeId, newData);\n      }\n    };\n\n    this.deleteSelectedShape = () => {\n      let shapesMap = { ...this.state.shapesMap\n      };\n      shapesMap[this.state.selectedShapeId].visible = false;\n      this.setState({\n        shapesMap,\n        selectedShapeId: undefined\n      });\n      let cmdObj = new DeleteCmdObj(this.undoHandler, shapesMap[this.state.selectedShapeId], this.state.selectedShapeId);\n      cmdObj.execute();\n    };\n\n    this.changeCurrMode = mode => {\n      if (mode === \"line\") {\n        this.setState({\n          currMode: mode,\n          currBorderColor: defaultValues.borderColor\n        });\n      } else {\n        this.setState({\n          currMode: mode\n        });\n      }\n    };\n\n    this.changeCurrBorderColor = borderColor => {\n      this.setState({\n        currBorderColor: borderColor\n      });\n\n      if (this.state.selectedShapeId) {\n        let cmdObj = new ChangeBorderColorCmdObj(this.undoHandler, this.state.shapesMap[this.state.selectedShapeId], this.state.selectedShapeId, this.state.currBorderColor, borderColor);\n        cmdObj.execute();\n        this.updateShape(this.state.selectedShapeId, {\n          borderColor\n        });\n      }\n    };\n\n    this.changeCurrBorderWidth = borderWidth => {\n      this.setState({\n        currBorderWidth: borderWidth\n      });\n\n      if (this.state.selectedShapeId) {\n        this.updateShape(this.state.selectedShapeId, {\n          borderWidth\n        });\n      }\n    };\n\n    this.AddChangeBorderWidthCmd = (borderWidth, oldWidth) => {\n      let cmdObj = new ChangeBorderWidthCmdObj(this.undoHandler, this.state.shapesMap[this.state.selectedShapeId], this.state.selectedShapeId, oldWidth, borderWidth);\n      cmdObj.execute();\n    };\n\n    this.changeCurrFillColor = fillColor => {\n      this.setState({\n        currFillColor: fillColor\n      });\n\n      if (this.state.selectedShapeId) {\n        let cmdObj = new ChangeFillColorCommandObject(this.undoHandler, this.state.shapesMap[this.state.selectedShapeId], this.state.selectedShapeId, this.state.currFillColor, fillColor);\n        cmdObj.execute();\n        this.updateShape(this.state.selectedShapeId, {\n          fillColor\n        });\n      }\n    };\n\n    this.unAddShape = shapeId => {\n      let shapesMap = { ...this.state.shapesMap\n      };\n      shapesMap[shapeId].visible = false;\n      this.setState({\n        shapesMap,\n        selectedShapeId: undefined\n      });\n    };\n\n    this.reAddShape = shapeId => {\n      let shapesMap = { ...this.state.shapesMap\n      };\n      shapesMap[shapeId].visible = true;\n      this.setState({\n        shapesMap,\n        selectedShapeId: shapeId\n      });\n    };\n\n    this.setPaletteValues = values => {\n      this.setState({\n        currMode: values.mode,\n        currBorderColor: values.borderColor,\n        currBorderWidth: values.borderWidth,\n        currFillColor: values.fillColor\n      });\n    };\n\n    this.addMoveCmdObj = (oldValue, newValue) => {\n      let cmdObj = new MoveCmdObj(this.undoHandler, this.state.shapesMap[this.state.selectedShapeId], this.state.selectedShapeId, oldValue, newValue);\n      cmdObj.execute();\n    };\n\n    this.keyDownHandler = e => {\n      if (e.metaKey || e.ctrlKey) {\n        this.setState({\n          cKey: true,\n          zKey: false\n        });\n      }\n    };\n\n    this.keyUpHandler = e => {};\n\n    this.undoHandler = {\n      registerExecution: this.registerExecution,\n      updateShape: this.updateShape,\n      unAddShape: this.unAddShape,\n      reAddShape: this.reAddShape,\n      setPaletteValues: this.setPaletteValues // TODO: fill this up with whatever you need for the command objects\n\n    };\n  }\n  /*\n   * TODO:\n   * add the commandObj to the commandList so\n   * that is available for undoing.\n   */\n\n\n  render() {\n    const {\n      currMode,\n      currBorderColor,\n      currBorderWidth,\n      currFillColor,\n      shapes,\n      shapesMap,\n      selectedShapeId,\n      undoAllowed,\n      redoAllowed\n    } = this.state;\n    window.addEventListener(\"keydown\", this.keyDownHandler, true);\n    window.addEventListener(\"keyUp\", this.keyUpHandler, true); // update the context with the functions and values defined above and from state\n    // and pass it to the structure below it (control panel and workspace)\n\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(ControlContext.Provider, {\n      value: {\n        currMode,\n        changeCurrMode: this.changeCurrMode,\n        currBorderColor,\n        changeCurrBorderColor: this.changeCurrBorderColor,\n        currBorderWidth,\n        changeCurrBorderWidth: this.changeCurrBorderWidth,\n        AddChangeBorderWidthCmd: this.AddChangeBorderWidthCmd,\n        currFillColor,\n        changeCurrFillColor: this.changeCurrFillColor,\n        addMoveCmdObj: this.addMoveCmdObj,\n        shapes,\n        shapesMap,\n        addShape: this.addShape,\n        moveShape: this.moveShape,\n        selectedShapeId,\n        selectShape: id => {\n          this.setState({\n            selectedShapeId: id\n          });\n\n          if (id) {\n            const {\n              borderColor,\n              borderWidth,\n              fillColor\n            } = shapesMap[shapes.filter(shapeId => shapeId === id)[0]];\n            this.setState({\n              currBorderColor: borderColor,\n              currBorderWidth: borderWidth,\n              currFillColor: fillColor\n            });\n          }\n        },\n        deleteSelectedShape: this.deleteSelectedShape,\n        undo: this.undo,\n        redo: this.redo,\n        undoAllowed,\n        redoAllowed\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ControlPanel, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(Workspace, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(HistoryPanel, {\n      commandListObjs: this.state.commandList,\n      currCmdIndex: this.state.currCommand,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 11\n      }\n    })));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/phoebe0506/github-classroom/CMU-SSUI-Fall2022/hw5-hsuanjuw/src/App.js"],"names":["React","Component","ControlPanel","Workspace","HistoryPanel","ControlContext","genId","defaultValues","ChangeFillColorCommandObject","ChangeBorderColorCmdObj","ChangeBorderWidthCmdObj","AddShapeCmdObj","DeleteCmdObj","MoveCmdObj","App","constructor","state","currMode","mode","currBorderColor","borderColor","currBorderWidth","borderWidth","currFillColor","fillColor","shapes","shapesMap","selectedShapeId","undefined","commandList","currCommand","undoAllowed","redoAllowed","undoKeys","cKey","zKey","redoKeys","yKey","registerExecution","commandObject","newCmdList","length","slice","setState","undo","redo","addShape","shapeData","id","push","cmdObj","undoHandler","execute","updateShape","shapeId","newData","targetShape","moveShape","deleteSelectedShape","visible","changeCurrMode","changeCurrBorderColor","changeCurrBorderWidth","AddChangeBorderWidthCmd","oldWidth","changeCurrFillColor","unAddShape","reAddShape","setPaletteValues","values","addMoveCmdObj","oldValue","newValue","keyDownHandler","e","metaKey","ctrlKey","keyUpHandler","render","window","addEventListener","selectShape","filter"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\n\nimport ControlPanel from \"./containers/ControlPanel/ControlPanel\";\nimport Workspace from \"./containers/Workspace/Workspace\";\nimport HistoryPanel from \"./containers/HistoryPanel/HistoryPanel\";\n\nimport ControlContext from \"./contexts/control-context\";\nimport { genId, defaultValues } from \"./shared/util\";\nimport ChangeFillColorCommandObject from \"./shared/commandObjects/ChangeFillColorCommandObject\";\nimport ChangeBorderColorCmdObj from \"./shared/commandObjects/ChangeBorderColorCmdObj\";\nimport ChangeBorderWidthCmdObj from \"./shared/commandObjects/ChangeBorderWidthCmdObj\";\nimport AddShapeCmdObj from \"./shared/commandObjects/AddShapeCmdObj\";\nimport DeleteCmdObj from \"./shared/commandObjects/DeleteCmdObj\";\nimport MoveCmdObj from \"./shared/commandObjects/MoveCmdObj\";\n\nimport \"./App.css\";\n\n\nclass App extends Component {\n  state = {\n    // controls\n    currMode: defaultValues.mode,\n    currBorderColor: defaultValues.borderColor,\n    currBorderWidth: defaultValues.borderWidth,\n    currFillColor: defaultValues.fillColor,\n\n    // workspace\n    shapes: [],\n    shapesMap: {},\n    selectedShapeId: undefined,\n\n    // handling undo/redo\n    commandList: [],\n    currCommand: -1,\n    undoAllowed: false,\n    redoAllowed: false,\n\n    //handle key pressed\n    undoKeys: {cKey: false, zKey: false},\n    redoKeys: {cKey: false, yKey: false}\n  };\n\n  constructor() {\n    super();\n\n    /*\n     * pass this undoHandler into command object constructors:\n     *  e.g. let cmdObj = new ChangeFillColorCommandObject(this.undoHandler);\n     */\n    this.undoHandler = {\n      registerExecution: this.registerExecution,\n      updateShape: this.updateShape,\n      unAddShape: this.unAddShape,\n      reAddShape: this.reAddShape,\n      setPaletteValues: this.setPaletteValues\n      // TODO: fill this up with whatever you need for the command objects\n    };\n  }\n\n  /*\n   * TODO:\n   * add the commandObj to the commandList so\n   * that is available for undoing.\n   */\n  registerExecution = (commandObject) => {\n    let newCmdList = [];\n    if (this.state.commandList.length !== this.state.currCommand+1) {\n      newCmdList = this.state.commandList.slice(0, this.state.currCommand+1 )\n    }\n    else{\n      newCmdList = [...this.state.commandList];\n    }\n    this.setState({\n      commandList: [...newCmdList, commandObject],\n      currCommand: this.state.currCommand + 1\n    });\n  };\n\n  /*\n   * TODO:\n   * actually call the undo method of the command at\n   * the current position in the undo stack\n   */\n  undo = () => {\n    //console.log(\"undo\");\n    if (this.state.currCommand-1 === -1){\n      this.setState({\n        undoAllowed: false\n      }); \n    }\n\n    if(this.state.currCommand !== -1){\n      this.setState({\n        selectedShapeId: this.state.commandList[this.state.currCommand].selectedShapeId\n      });        \n      this.state.commandList[this.state.currCommand].undo();\n      //var oldValue = this.state.commandList[this.state.currCommand].oldValue;\n      //this.updateShape(this.state.commandList[this.state.currCommand].selectedShapeId, { oldValue });\n      this.setState({\n        currCommand: this.state.currCommand - 1,\n        redoAllowed: true\n      });  \n    }\n  };\n\n  /*\n   * TODO:\n   * actually call the redo method of the command at\n   * the current position in the undo stack. Note that this is\n   * NOT the same command as would be affected by a doUndo()\n   */\n  redo = () => {\n    //console.log(\"redo\"); \n    if (this.state.currCommand+1 === this.state.commandList.length-1){\n      this.setState({\n        redoAllowed: false,\n        undoAllowed: true\n      }); \n    }\n    this.state.commandList[this.state.currCommand+1].redo();\n    this.setState({\n      currCommand: this.state.currCommand + 1,\n    }); \n  };\n\n  // add the shapeId to the array, and the shape itself to the map\n  addShape = (shapeData) => {\n    let shapes = [...this.state.shapes];\n    let shapesMap = { ...this.state.shapesMap };\n    const id = genId();\n    shapesMap[id] = {\n      ...shapeData,\n      id,\n    };\n    shapes.push(id);\n    this.setState({ shapes, shapesMap, selectedShapeId: id, undoAllowed: true });\n\n    let cmdObj = new AddShapeCmdObj(\n      this.undoHandler,\n      shapeData, \n      id,\n    );\n    cmdObj.execute();\n\n  };\n\n  // get the shape by its id, and update its properties\n  updateShape = (shapeId, newData) => {\n    let shapesMap = { ...this.state.shapesMap };\n    let targetShape = shapesMap[shapeId];\n    shapesMap[shapeId] = { ...targetShape, ...newData };\n    this.setState({ shapesMap });\n  };\n\n  moveShape = (newData) => {\n    if (this.state.selectedShapeId) {\n      this.updateShape(this.state.selectedShapeId, newData);\n    }\n  };\n\n  // deleting a shape sets its visibility to false, rather than removing it\n  deleteSelectedShape = () => {\n    let shapesMap = { ...this.state.shapesMap };\n    shapesMap[this.state.selectedShapeId].visible = false;\n    this.setState({ shapesMap, selectedShapeId: undefined });\n\n    let cmdObj = new DeleteCmdObj(\n      this.undoHandler,\n      shapesMap[this.state.selectedShapeId], \n      this.state.selectedShapeId,\n    );\n    cmdObj.execute();\n  };\n\n  changeCurrMode = (mode) => {\n    if (mode === \"line\") {\n      this.setState({\n        currMode: mode,\n        currBorderColor: defaultValues.borderColor,\n      });\n    } else {\n      this.setState({ currMode: mode });\n    }\n  };\n\n  changeCurrBorderColor = (borderColor) => {\n    this.setState({ currBorderColor: borderColor });\n    if (this.state.selectedShapeId) {\n      let cmdObj = new ChangeBorderColorCmdObj(\n        this.undoHandler,\n        this.state.shapesMap[this.state.selectedShapeId], \n        this.state.selectedShapeId,\n        this.state.currBorderColor, \n        borderColor\n      );\n      cmdObj.execute();\n      this.updateShape(this.state.selectedShapeId, { borderColor });\n    }\n  };\n\n  changeCurrBorderWidth = (borderWidth) => {\n    this.setState({ currBorderWidth: borderWidth });\n    if (this.state.selectedShapeId) {\n      this.updateShape(this.state.selectedShapeId, { borderWidth });\n    }\n  };\n\n  AddChangeBorderWidthCmd = (borderWidth, oldWidth) => {\n    let cmdObj = new ChangeBorderWidthCmdObj(\n      this.undoHandler,\n      this.state.shapesMap[this.state.selectedShapeId], \n      this.state.selectedShapeId,\n      oldWidth, \n      borderWidth\n    );\n    cmdObj.execute();  \n  }\n\n  changeCurrFillColor = (fillColor) => {\n    \n    this.setState({ currFillColor: fillColor });\n    if (this.state.selectedShapeId) {\n      let cmdObj = new ChangeFillColorCommandObject(\n        this.undoHandler,\n        this.state.shapesMap[this.state.selectedShapeId], \n        this.state.selectedShapeId,\n        this.state.currFillColor, \n        fillColor\n      );\n      cmdObj.execute();\n      this.updateShape(this.state.selectedShapeId, { fillColor });\n    }\n  };\n\n  // For Undo Redo\n  unAddShape = (shapeId) => {\n    let shapesMap = { ...this.state.shapesMap };\n    shapesMap[shapeId].visible = false;\n    this.setState({shapesMap, selectedShapeId: undefined});   \n  }\n\n  reAddShape = (shapeId) => {\n    let shapesMap = { ...this.state.shapesMap };\n    shapesMap[shapeId].visible = true;\n    this.setState({shapesMap, selectedShapeId: shapeId});   \n  }\n\n  setPaletteValues = (values) => {\n    this.setState({\n      currMode: values.mode,\n      currBorderColor: values.borderColor,\n      currBorderWidth: values.borderWidth,\n      currFillColor: values.fillColor\n    });\n  }\n\n  addMoveCmdObj = (oldValue, newValue) => {\n    let cmdObj = new MoveCmdObj(\n      this.undoHandler,\n      this.state.shapesMap[this.state.selectedShapeId], \n      this.state.selectedShapeId,\n      oldValue, \n      newValue\n    );\n    cmdObj.execute();\n  }\n\n  keyDownHandler = (e) => {\n    if (e.metaKey || e.ctrlKey){\n      this.setState({\n        cKey: true, \n        zKey: false\n      });\n    }\n  }\n\n  keyUpHandler = (e) => {\n\n  }\n\n  render() {\n    const {\n      currMode,\n      currBorderColor,\n      currBorderWidth,\n      currFillColor,\n      shapes,\n      shapesMap,\n      selectedShapeId,\n      undoAllowed,\n      redoAllowed\n    } = this.state;\n\n    window.addEventListener(\"keydown\", this.keyDownHandler, true);\n    window.addEventListener(\"keyUp\", this.keyUpHandler, true);\n    // update the context with the functions and values defined above and from state\n    // and pass it to the structure below it (control panel and workspace)\n    return (\n      <React.Fragment>\n        <ControlContext.Provider\n          value={{\n            currMode,\n            changeCurrMode: this.changeCurrMode,\n            currBorderColor,\n            changeCurrBorderColor: this.changeCurrBorderColor,\n            currBorderWidth,\n            changeCurrBorderWidth: this.changeCurrBorderWidth,\n            AddChangeBorderWidthCmd: this.AddChangeBorderWidthCmd,\n            currFillColor,\n            changeCurrFillColor: this.changeCurrFillColor,\n            addMoveCmdObj: this.addMoveCmdObj,\n            shapes,\n            shapesMap,\n            addShape: this.addShape,\n            moveShape: this.moveShape,\n            selectedShapeId,\n            selectShape: (id) => {\n              this.setState({ selectedShapeId: id });\n              if (id) {\n                const { borderColor, borderWidth, fillColor } = shapesMap[\n                  shapes.filter((shapeId) => shapeId === id)[0]\n                ];\n                this.setState({\n                  currBorderColor: borderColor,\n                  currBorderWidth: borderWidth,\n                  currFillColor: fillColor,\n                });\n              }\n            },\n            deleteSelectedShape: this.deleteSelectedShape,\n\n            undo: this.undo,\n            redo: this.redo,\n            undoAllowed,\n            redoAllowed\n          }}\n        >\n          <ControlPanel />\n          <Workspace />\n          <HistoryPanel commandListObjs = {this.state.commandList} currCmdIndex = {this.state.currCommand}/>\n        </ControlContext.Provider>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}